filename <-
paste0(
"pge_data/PGE_",
year,
"_Q",
quarter,
"_",
type,
"UsageByZip.csv"
)
print(filename)
# for Q's that don't exist
if(!file.exists(filename)) next
temp <- read_csv(filename)
# converting to standardize units
if(type == "Electric") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALKWH * 3.412) %>%
select(-AVERAGEKWH,-TOTALKWH)
}
if(type == "Gas") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALTHM * 99.976) %>%
select(-AVERAGETHM,-TOTALTHM)
}
pge_data_raw <-
rbind(pge_data_raw, temp)
}
}
}
View(pge_data_raw)
View(pge_data_raw)
residential_data <-
filter(pge_data_raw, CUSTOMERCLASS %in%
c("Elec- Residential", "Gas- Residential"))
View(residential_data)
commercial_data <-
filter(pge_data_raw, CUSTOMERCLASS %in%
c("Elec- Commercial", "Gas- Commercial"))
View(commercial_data)
# make two data objects for plotting later
# one for resdiential, one for commercial
residential_data <-
filter(
pge_data_raw, CUSTOMERCLASS %in%
c(
"Elec- Residential",
"Gas- Residential"
)
)
commercial_data <-
filter(
pge_data_raw, CUSTOMERCLASS %in%
c(
"Elec- Commercial",
"Gas- Commercial"
)
)
View(residential_data)
# selecting only the columns we want
names(residential_data)
names(commercial_data)
commercial_data[1]
commercial_data[2]
res_data_to_plot <-
residential_data[2,3,4,7]
res_data_to_plot <-
residential_data[2,3,4,7]
res_data_to_plot <-
residential_data[2,3,4,7]
res_data_to_plot
res_data_to_plot <-
select(
residential_data,
MONTH, YEAR, CUSTOMERCLASS, TOTALKBTU
)
View(res_data_to_plot)
View(pge_data_raw)
com_data_to_plot <-
select(
commercial_data,
MONTH, YEAR, CUSTOMERCLASS, TOTALKBTU
)
View(com_data_to_plot)
# grouping data by month, customer class
# res
res_data_to_plot_grouped <-
group_by(
res_data_to_plot,
MONTH, CUSTOMERCLASS
)
# com
com_data_to_plot_grouped <-
group_by(
com_data_to_plot,
MONTH, CUSTOMERCLASS
)
View(com_data_to_plot_grouped)
# summarize to sum up by month
res_month_summed <-
summarise(
res_data_to_plot_grouped,
TOTALKWH = sum(TOTALKWH, na.rm = T)
)
# grouping data by month, customer class
# res
res_data_to_plot_grouped <-
group_by(
res_data_to_plot,
MONTH, CUSTOMERCLASS
)
# com
com_data_to_plot_grouped <-
group_by(
com_data_to_plot,
MONTH, CUSTOMERCLASS
)
# summarize to sum up by month
res_month_summed <-
summarise(
res_data_to_plot_grouped,
TOTALKWH = sum(TOTALKWH, na.rm = T)
)
View(com_data_to_plot_grouped)
# summarize to sum up by month
res_month_summed <-
summarise(
res_data_to_plot_grouped,
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
)
com_month_summed <-
summarise(
com_data_to_plot_grouped,
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
)
?na.rm
?na
??nma
?na
?rm
?.rm
View(com_month_summed)
res_plot <-
ggplot(res_month_summed)
View(res_month_summed)
View(res_plot)
res_plot <-
res_month_summed %>%
ggplot() +
geom_bar(
aes(
x = MONTH,
y = TOTALKWH,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kWh",
title = "Residential Energy Use 2017-2021",
fill = "what do I write for fill?"
)
View(res_plot)
res_plot
View(res_month_summed)
res_plot <-
res_month_summed %>%
ggplot() +
geom_bar(
aes(
x = MONTH,
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kWh",
title = "Residential Energy Use 2017-2021",
fill = "what do I write for fill?"
)
res_plot
# commercial
com_plot <-
com_month_summed %>%
ggplot() +
geom_bar(
aes(
x = MONTH,
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kWh",
title = "Residential Energy Use 2017-2021",
fill = "what do I write for fill?"
)
com_plot
5 %% 2
5 $$ 4
5%%4
2017%%2017
2017 %% 2018
2018 %% 2017
2019 %% 2017
View(res_data_to_plot)
# create month index to give us our 54 months
res_data_to_plot <-
mutate(res_data_to_plot,
MONTH_INDEX = YEAR %% 2017 + MONTH)
View(res_data_to_plot)
# create month index to give us our 54 months
res_data_to_plot <-
mutate(res_data_to_plot,
MONTH_INDEX = 12 * (YEAR %% 2017) + MONTH)
View(res_data_to_plot)
com_data_to_plot <-
mutate(com_data_to_plot,
MONTH_INDEX = 12 * (YEAR %% 2017) + MONTH)
View(com_data_to_plot)
# residential
res_plot <-
res_month_summed %>%
ggplot() +
geom_bar(
aes(
x = MONTH,
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kWh",
title = "Residential Energy Use 2017-2021",
fill = "what do I write for fill?"
)
res_plot
# make two data objects for plotting later
# one for resdiential, one for commercial
residential_data <-
filter(
pge_data_raw, CUSTOMERCLASS %in%
c(
"Elec- Residential",
"Gas- Residential"
)
)
commercial_data <-
filter(
pge_data_raw, CUSTOMERCLASS %in%
c(
"Elec- Commercial",
"Gas- Commercial"
)
)
# selecting only the columns we want
res_data_to_plot <-
select(
residential_data,
MONTH, YEAR, CUSTOMERCLASS, TOTALKBTU
)
com_data_to_plot <-
select(
commercial_data,
MONTH, YEAR, CUSTOMERCLASS, TOTALKBTU
)
# create month index to give us our 54 months
res_data_to_plot <-
mutate(res_data_to_plot,
MONTH_INDEX = 12 * (YEAR %% 2017) + MONTH)
com_data_to_plot <-
mutate(com_data_to_plot,
MONTH_INDEX = 12 * (YEAR %% 2017) + MONTH)
# grouping data by month, customer class
# res
res_data_to_plot_grouped <-
group_by(
res_data_to_plot,
MONTH, CUSTOMERCLASS
)
# com
com_data_to_plot_grouped <-
group_by(
com_data_to_plot,
MONTH, CUSTOMERCLASS
)
# summarize to sum up by month
res_month_summed <-
summarise(
res_data_to_plot_grouped,
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
)
com_month_summed <-
summarise(
com_data_to_plot_grouped,
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
)
# residential
res_plot <-
res_month_summed %>%
ggplot() +
geom_bar(
aes(
x = MONTH,
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kWh",
title = "Residential Energy Use 2017-2021",
fill = "what do I write for fill?"
)
res_plot
res_plot
# commercial
com_plot <-
com_month_summed %>%
ggplot() +
geom_bar(
aes(
x = MONTH,
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kWh",
title = "Residential Energy Use 2017-2021",
fill = "what do I write for fill?"
)
com_plot
# make two data objects for plotting later
# one for resdiential, one for commercial
residential_data <-
filter(
pge_data_raw, CUSTOMERCLASS %in%
c(
"Elec- Residential",
"Gas- Residential"
)
)
residential_data <-
filter(
pge_data_raw, CUSTOMERCLASS %in%
c(
"Elec- Residential",
"Gas- Residential"
)
)
commercial_data <-
filter(
pge_data_raw, CUSTOMERCLASS %in%
c(
"Elec- Commercial",
"Gas- Commercial"
)
)
# selecting only the columns we want
res_data_to_plot <-
select(
residential_data,
MONTH, YEAR, CUSTOMERCLASS, TOTALKBTU
)
com_data_to_plot <-
select(
commercial_data,
MONTH, YEAR, CUSTOMERCLASS, TOTALKBTU
)
# create month index to give us our 54 months
res_data_to_plot <-
mutate(res_data_to_plot,
MONTH_INDEX = 12 * (YEAR %% 2017) + MONTH)
com_data_to_plot <-
mutate(com_data_to_plot,
MONTH_INDEX = 12 * (YEAR %% 2017) + MONTH)
# grouping data by month, customer class
# res
res_data_to_plot_grouped <-
group_by(
res_data_to_plot,
MONTH, CUSTOMERCLASS
)
# com
com_data_to_plot_grouped <-
group_by(
com_data_to_plot,
MONTH, CUSTOMERCLASS
)
# summarize to sum up by month
res_month_summed <-
summarise(
res_data_to_plot_grouped,
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
)
com_month_summed <-
summarise(
com_data_to_plot_grouped,
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
)
View(residential_data)
# grouping data by month, customer class
# res
res_data_to_plot_grouped <-
group_by(
res_data_to_plot,
MONTH_INDEX, CUSTOMERCLASS
)
# com
com_data_to_plot_grouped <-
group_by(
com_data_to_plot,
MONTH_INDEX, CUSTOMERCLASS
)
# summarize to sum up by month
res_month_summed <-
summarise(
res_data_to_plot_grouped,
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
)
com_month_summed <-
summarise(
com_data_to_plot_grouped,
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
)
#left off from textbook 1.7 3/4 down, "You'll notice that.."
```
# plotting
```{r}
# residential
res_plot <-
res_month_summed %>%
ggplot() +
geom_bar(
aes(
x = MONTH,
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kWh",
title = "Residential Energy Use 2017-2021",
fill = "what do I write for fill?"
)
res_plot
# residential
res_plot <-
res_month_summed %>%
ggplot() +
geom_bar(
aes(
x = MONTH_INDEX,
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kWh",
title = "Residential Energy Use 2017-2021",
fill = "what do I write for fill?"
)
res_plot
# commercial
com_plot <-
com_month_summed %>%
ggplot() +
geom_bar(
aes(
x = MONTH_INDEX,
y = TOTALKBTU,
fill = CUSTOMERCLASS
),
stat = "identity",
position = "stack"
) +
labs(
x = "Month",
y = "kWh",
title = "Residential Energy Use 2017-2021",
fill = "what do I write for fill?"
)
com_plot
res_plot %>% ggplotly()
library(plotly)
res_plot %>% ggplotly()
com_plot %>% ggplotly()
