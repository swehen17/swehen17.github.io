# for Q's that don't exist
if(!file.exists(filename)) next
temp <- read_csv(filename)
if(type == "Electric") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALKWH * 3.412) %>%
select(-TOTALKWH)
}
if(type == "Gas") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALTHM * 99.976) %>%
select(-TOTALTHM)
}
pge_data_raw <-
rbind(pge_data_raw, temp)
}
}
}
```
knitr::opts_chunk$set(warning = F, message = F)
library(tigris)
library(tidyverse)
library(sf)
library(mapview)
library(leaflet)
library(censusapi)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
years <- 2017:2021
quarters <- 1:4
types <- c("Electric","Gas")
pge_data_raw <- NULL
for(year in years) {
for(quarter in quarters) {
for(type in types) {
filename <-
paste0(
"PGE_",
year,
"_Q",
quarter,
"_",
type,
"UsageByZip.csv"
)
print(filename)
# for Q's that don't exist
if(!file.exists(filename)) next
temp <- read_csv(filename)
if(type == "Electric") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALKWH * 3.412) %>%
select(-TOTALKWH)
}
if(type == "Gas") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALTHM * 99.976) %>%
select(-TOTALTHM)
}
pge_data_raw <-
rbind(pge_data_raw, temp)
}
}
}
years <- 2017:2021
quarters <- 1:4
types <- c("Electric","Gas")
pge_data_raw <- NULL
for(year in years) {
for(quarter in quarters) {
for(type in types) {
filename <-
paste0(
"PGE_",
year,
"_Q",
quarter,
"_",
type,
"UsageByZip.csv"
)
print(filename)
# for Q's that don't exist
if(!file.exists(filename)) next
temp <- read_csv(filename)
if(type == "Electric") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALKWH * 3.412) %>%
select(temp,-TOTALKWH)
}
if(type == "Gas") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALTHM * 99.976) %>%
select(temp,-TOTALTHM)
}
pge_data_raw <-
rbind(pge_data_raw, temp)
}
}
}
rlang::last_error()
View(temp)
years <- 2017:2021
quarters <- 1:4
types <- c("Electric","Gas")
pge_data_raw <- NULL
for(year in years) {
for(quarter in quarters) {
for(type in types) {
filename <-
paste0(
"PGE_",
year,
"_Q",
quarter,
"_",
type,
"UsageByZip.csv"
)
print(filename)
# for Q's that don't exist
if(!file.exists(filename)) next
temp <- read_csv(filename)
if(type == "Electric") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALKWH * 3.412) %>%
select(-AVERAGEKWH,-TOTALKWH)
}
if(type == "Gas") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALTHM * 99.976) %>%
select(-AVERAGETHM,-TOTALTHM)
}
pge_data_raw <-
rbind(pge_data_raw, temp)
}
}
}
View(pge_data_raw)
View(pge_data_raw)
pge_data <-
pge_data_raw %>%
filter(
CUSTOMERCLASS %in% c(
"Elec- Commercial",
"Elec- Residential",
"Gas- Commercial",
"Gas- Residential"
)
) %>%
group_by(
MONTH,
YEAR,
TOTALKBTU
) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
mutate(
DATE =
paste(
YEAR,
MONTH,
"01",
sep="-"
) %>% as.Date()
)
View(pge_data)
?as.Date
pge_data %>%
filter(CUSTOMERCLASS %in% c("Elec- Residential", "Gas- Residential")) %>%
ggplot() +
geom_line(
aes(
x = MONTH,
y = TOTALKBTU,
color = 1
)
) +
labs(
x = "Month",
y = "Total kBtu",
title = "Energy Use By Month, Residential",
color = 1
) +
theme(
legend.position = 1
)
View(pge_data)
pge_data <-
pge_data_raw %>%
filter(
CUSTOMERCLASS %in% c(
"Elec- Commercial",
"Elec- Residential",
"Gas- Commercial",
"Gas- Residential"
)
) %>%
group_by(
CUSTOMERCLASS,
MONTH,
YEAR,
TOTALKBTU
) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
mutate(
DATE =
paste(
YEAR,
MONTH,
"01",
sep="-"
) %>% as.Date()
)
pge_data %>%
filter(CUSTOMERCLASS %in% c("Elec- Residential", "Gas- Residential")) %>%
ggplot() +
geom_line(
aes(
x = MONTH,
y = TOTALKBTU,
color = 1
)
) +
labs(
x = "Month",
y = "Total kBtu",
title = "Energy Use By Month, Residential",
color = 1
) +
theme(
legend.position = 1
)
pge_data %>%
filter(CUSTOMERCLASS %in% c("Elec- Residential", "Gas- Residential")) %>%
ggplot() +
geom_line(
aes(
x = MONTH %>% factor(),
y = TOTALKBTU,
color = 1
)
) +
labs(
x = "Month",
y = "Total kBtu",
title = "Energy Use By Month, Residential",
color = 1
) +
theme(
legend.position = 1
)
pge_data %>%
filter(CUSTOMERCLASS %in% c("Elec- Residential", "Gas- Residential")) %>%
ggplot() +
geom_line(
aes(
x = DATE # %>% factor(),
y = TOTALKBTU,
color = 1
)
) +
labs(
x = "Month",
y = "Total kBtu",
title = "Energy Use By Month, Residential",
color = 1
) +
theme(
legend.position = 1
)
pge_data <-
pge_data_raw %>%
filter(
CUSTOMERCLASS %in% c(
"Elec- Commercial",
"Elec- Residential",
"Gas- Commercial",
"Gas- Residential"
)
) %>%
group_by(
CUSTOMERCLASS,
MONTH,
YEAR,
TOTALKBTU
) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
mutate(
DATE =
paste(
YEAR,
MONTH,
"01",
sep="-"
) %>% as.Date()
)
pge_data %>%
filter(CUSTOMERCLASS %in% c("Elec- Residential", "Gas- Residential")) %>%
ggplot() +
geom_line(
aes(
x = DATE,
y = TOTALKBTU,
color = 1
)
) +
labs(
x = "Month",
y = "Total kBtu",
title = "Energy Use By Month, Residential",
color = 1
) +
theme(
legend.position = 1
)
pge_data %>%
filter(CUSTOMERCLASS %in% c("Elec- Commercial", "Gas- Commercial")) %>%
ggplot() +
geom_line(
aes(
x = DATE,
y = TOTALKBTU,
color = 2
)
) +
labs(
x = "Month",
y = "Total kBtu",
title = "Energy Use By Month, Commercial",
color = 2
) +
theme(
legend.position = 2
)
---
title: "Swen_A1_v3"
author: "Swen Hendrickson"
date: "9/27/2021"
output: html_document
editor_options:
chunk_output_type: console
---
# initial note:
I got caught off guard on this assignment. I burned a good amount of time early on just reading the textbook without actually trying each step in R studio. Also don't have much programming experience, new to R, busy quarter, etc, etc. Anyway, excuses, I know. But just wanted to state up front that I'm aware the code doesn't have full functionality and isn't top quality work. In my own attempt (before receiving the helper code), I got about halfway through producing the plots, but was using way too many lines of code. Hoping to adjust my approach and tackle this material more efficiently / effectively looking forward..
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
knitr::opts_chunk$set(warning = F, message = F)
library(tigris)
library(tidyverse)
library(sf)
library(mapview)
library(leaflet)
library(censusapi)
Sys.setenv(CENSUS_KEY="c8aa67e4086b4b5ce3a8717f59faa9a28f611dab")
```
# Using loops to import data (stored locally as CSVs), standardizing energy units
```{r}
years <- 2017:2021
quarters <- 1:4
types <- c("Electric","Gas")
pge_data_raw <- NULL
for(year in years) {
for(quarter in quarters) {
for(type in types) {
filename <-
paste0(
"PGE_",
year,
"_Q",
quarter,
"_",
type,
"UsageByZip.csv"
)
print(filename)
# for Q's that don't exist
if(!file.exists(filename)) next
temp <- read_csv(filename)
# converting to standardize units
if(type == "Electric") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALKWH * 3.412) %>%
select(-AVERAGEKWH,-TOTALKWH)
}
if(type == "Gas") {
temp <-
temp %>%
mutate(TOTALKBTU = TOTALTHM * 99.976) %>%
select(-AVERAGETHM,-TOTALTHM)
}
pge_data_raw <-
rbind(pge_data_raw, temp)
}
}
}
```
Derek: There is one genuine problem with the data..
# is it the Agricultural data?
# filtering to give us our four classes (eliminating industrial and agricultural)
# also summing up energy use (TOTALKBTU) by month, and creating an ordered date category
```{r}
pge_data <-
pge_data_raw %>%
filter(
CUSTOMERCLASS %in% c(
"Elec- Commercial",
"Elec- Residential",
"Gas- Commercial",
"Gas- Residential"
)
) %>%
group_by(
CUSTOMERCLASS,
MONTH,
YEAR,
TOTALKBTU
) %>%
summarize(
TOTALKBTU = sum(TOTALKBTU, na.rm = T)
) %>%
mutate(
DATE =
paste(
YEAR,
MONTH,
"01",
sep="-"
) %>% as.Date()
)
```
# plotting residential data on a line chart
# note: given more
```{r}
pge_data %>%
filter(CUSTOMERCLASS %in% c("Elec- Residential", "Gas- Residential")) %>%
ggplot() +
geom_line(
aes(
x = DATE,
y = TOTALKBTU,
color = 1
)
) +
labs(
x = "Month",
y = "Total kBtu",
title = "Energy Use By Month, Residential",
color = 1
) +
theme(
legend.position = 1
)
```
You should now write some similar code to visualize commercial energy.
Include commentary throughout this document, replacing my own commentary.
```{r}
pge_data %>%
filter(CUSTOMERCLASS %in% c("Elec- Commercial", "Gas- Commercial")) %>%
ggplot() +
geom_line(
aes(
x = DATE,
y = TOTALKBTU,
color = 2
)
) +
labs(
x = "Month",
y = "Total kBtu",
title = "Energy Use By Month, Commercial",
color = 2
) +
theme(
legend.position = 2
)
```
setwd("~/GitHub/swehen17.github.io")
pge_data %>%
filter(CUSTOMERCLASS %in% c("Elec- Commercial", "Gas- Commercial")) %>%
ggplot() +
geom_line(
aes(
x = DATE,
y = TOTALKBTU,
color = 2
)
) +
labs(
x = "Month",
y = "Total kBtu",
title = "Energy Use By Month, Commercial",
color = 2
) +
theme(
legend.position = 2
)
